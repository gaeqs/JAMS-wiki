---
sidebar_position: 7
---

# Memory


import Caches from '/img/docs/architecture/caches.svg';

The memory is the component of the simulator where an application's data and instructions are stored.

## Memory's structure

The MIPS32's memory is a 4 GB (2<sup>32</sup> bytes) memory split in the following sections:

|    Section    |     Type     | First address | Use                                                                |
|:-------------:|:------------:|:-------------:|--------------------------------------------------------------------|
|   Reserved    | Kernel Level |  0xFFFF0000   | Used to read and write to components.                              |
|  Kernel Data  | Kernel Level |  0x90000000   | Kernel static data.                                                |
|  Kernel Text  | Kernel Level |  0x80000000   | Kernel instructions                                                |
| Stack Segment |  User Level  |       ↓       | Stack                                                              |
| Dynamic Data  |  User Level  |       ↑       | Runtime-allocated memory.                                          |
|  Static Data  |  User Level  |  0x10000000   | Static data generated by directives on assembly.                   |
| Text Segment  |  User Level  |  0x04000000   | Application instructions.                                          |
|   Reserved    | Kernel Level |  0x00000000   | Reserved for the operating system. It has no use in the simulator. |

## Memory's implementation

Allocate 4 GB for each simulator is not a good idea: it will allocate a big chunk of a computer's RAM, and the big part
of the reserved memory won't be used.
To avoid this problem, there are several techniques used to implemente the memory:

- Limit the memory of each section.
- Split each section into subsections.

JAMS uses the second technique: each memory section is split into 4 KB chunks. These subsecciones won't be allocated
until they're required by the simulator.

With this implementation, an array with 2<sup>22</sup> (2<sup>32</sup> / 2<sup>12</sup>) elements is allocated at the
start of the simulation. This is equivalent to 8 MB. The memory will reserve chunks when needed.

## Caches

Caches are smaller and faster memories located between the memory and the CPU. Computers nowadays may have several
cache levels, acting one over another.

In JAMS, memories behave in a very similar way:

<center>
    <Caches/>
</center>

Both caches and memories implemente the `Memory` interface. This interface defines read and write methods. When a
simulator has to read or write into the memory, it invokes the corresponding method in its memory.

What the simulator doesn't know is that its memory can be a cache with a reference to another memory. When the cache
is invoked in a write/read operation, it is the cache the one that manages the operation and, if it is required, it
invokes its referenced memory.

With this simple architecture, a memory hierarchy generated. This hierarchy is very similar to the ones found in real
computers.

## Builders

To allow plugins to provide new cache and memory types, JAMS defines two [managers](managers) that store cache
and memory builders. These managers are the `MemoryBuilderManager` and the `CacheBuilderManager`. They store
`MemoryBuilder` and `CacheBuilder`, respectively.

The `MemoryBuilder` class is very simple: it contains a method use to create new memories of its type.

The `CacheBuilder` class is more complex: it also defines cache properties. The manager has registered the version
of the `CacheBuilder` with the default properties, while [configurations](../tutorial-basics/configurations) store
copies with the desired properties.